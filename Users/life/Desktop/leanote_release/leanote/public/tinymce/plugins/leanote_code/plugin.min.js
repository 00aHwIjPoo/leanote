tinymce.PluginManager.add("leanote_code",function(t){function e(t){var e,o=n.selection.getNode(),r=n.selection.getContent(),a=n.selection.getBookmark();if("PRE"==o.nodeName)$(o).attr("class","brush:"+t);else{if("BODY"==o.nodeName)return;try{e=$(r).text()}catch(c){}e?n.insertContent('<pre class="brush:'+t+'"> '+e+"</pre>"):(e=$(o).text(),$(o).replaceWith('<pre class="brush:'+t+'"> '+e+"</pre>"))}n.selection.moveToBookmark(a)}function o(){return function(){var e=this;t.on("nodeChange",function(){var o=null;try{var n=t.selection.getNode();"PRE"==n.nodeName&&(o=$.trim($(n).attr("class").split(":")[1]))}catch(r){}e.value(o)})}}var n=t;t.addButton("leanote_code",function(){var t=["CSS:css","C/C++:cpp","C#:c#","Javascript:javascript","Java:java","PHP:php","Python:python","Shell:shell","Delphi:delphi","Golang:golang","Erlang:erlang","Groovy:groovy","ActionScript:actionScript"],n=[];for(var r in t){var a=t[r].split(":");n.push({text:a[0],value:a[1]})}return{type:"listbox",text:"代码语言",tooltip:"ctrl+shift+c 切换代码",values:n,fixedWidth:!0,onselect:function(t){t.control.settings.value&&e(t.control.settings.value)},onPostRender:o(n)}}),n.addCommand("toggleCode",function(){var t,e=n.selection.getNode(),o=n.selection.getContent(),r=n.selection.getBookmark();try{t=$.trim($(o).text())}catch(a){}t||(t=$.trim(o)),t?"PRE"==e.nodeName?$(e).replaceWith("<p>"+$(e).html()+"</p>"):n.insertContent("<pre>"+t+"</pre>"):$(e).replaceWith("PRE"==e.nodeName?"<p>"+$(e).html().replace(/\n/g,"<br />")+"</p>":"<pre>"+$(e).html()+"</pre>"),n.selection.moveToBookmark(r)}),n.addShortcut("ctrl+shift+c","","toggleCode"),n.addShortcut("command+shift+c","","toggleCode")});